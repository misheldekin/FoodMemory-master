@page "/ChefLogin"
@using Models
@using DBL
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ProtectedSessionStorage Session
@inject NavigationManager Nav

<div class="chef-login-page" dir="rtl">
    <button class="back-home" @onclick="@(() => Nav.NavigateTo("/"))">✕</button>

    <div class="login-wrapper">
        <div class="brand-side">
            <div class="brand-content">
                <span class="emoji-logo">🔪</span>
                <h1>ברוך שובך, שף.</h1>
                <p>הסיפור הבא שלך מתחיל כאן.</p>
            </div>
        </div>

        <div class="form-side">
            <div class="form-container">
                <div class="header-minimal">
                    <h2>התחברות למערכת</h2>
                    <p>הכנס פרטים כדי לנהל את המתכונים שלך</p>
                </div>

                @if (!string.IsNullOrEmpty(ErrorMessage))
                {
                    <div class="elegant-error">
                        @ErrorMessage
                    </div>
                }

                <div class="input-stack">
                    <div class="field">
                        <input type="email" id="email" @bind="Email" placeholder=" " class="minimal-input" />
                        <label for="email">כתובת אימייל</label>
                    </div>

                    <div class="field">
                        <input type="password" id="password" @bind="Password" placeholder=" " class="minimal-input" />
                        <label for="password">סיסמה</label>
                    </div>
                </div>

                <button class="chef-submit-btn" @onclick="Login" disabled="@IsLoading">
                    @if (IsLoading)
                    {
                        <div class="dot-spinner"></div>
                    }
                    else
                    {

                        <span>היכנס למטבח</span>
                    }
                </button>

                <div class="form-footer">
                    <span>עדיין לא חלק מהקהילה?</span>
                    <a href="/ChefRegister">צור חשבון שף</a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --chef-dark: #2d3436;
        --chef-gold: #c29958;
        --chef-green: #4b5320;
        --soft-gray: #f8f9fa;
    }

    .chef-login-page {
        min-height: 100vh;
        background: #fdfcfb;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        font-family: 'Assistant', sans-serif;
    }

    .login-wrapper {
        background: white;
        display: flex;
        width: 100%;
        max-width: 900px;
        height: 600px;
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
    }

    /* צד המיתוג - תמונה או רקע אבסטרקטי */
    .brand-side {
        flex: 1;
        background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1556910103-1c02745aae4d?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80') center/cover;
        display: flex;
        align-items: flex-end;
        padding: 40px;
        color: white;
    }

    .emoji-logo {
        font-size: 3rem;
        margin-bottom: 20px;
        display: block;
    }

    .brand-side h1 {
        font-size: 2.5rem;
        margin: 0;
        font-weight: 800;
    }

    .brand-side p {
        opacity: 0.9;
        font-size: 1.1rem;
    }

    /* צד הטופס */
    .form-side {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        background: white;
    }

    .form-container {
        width: 100%;
        max-width: 340px;
    }

    .header-minimal {
        margin-bottom: 35px;
    }

        .header-minimal h2 {
            font-size: 1.8rem;
            color: var(--chef-dark);
            margin: 0;
        }

        .header-minimal p {
            color: #999;
            margin-top: 5px;
        }

    /* עיצוב שדות קלט מודרניים (Floating Labels) */
    .input-stack {
        margin-bottom: 30px;
    }

    .field {
        position: relative;
        margin-bottom: 20px;
    }

    .minimal-input {
        width: 100%;
        padding: 12px 0;
        border: none;
        border-bottom: 2px solid #eee;
        background: transparent;
        font-size: 1rem;
        transition: 0.3s;
        outline: none;
    }

    .field label {
        position: absolute;
        top: 12px;
        right: 0;
        color: #bbb;
        pointer-events: none;
        transition: 0.3s;
    }

    .minimal-input:focus ~ label,
    .minimal-input:not(:placeholder-shown) ~ label {
        top: -12px;
        font-size: 0.8rem;
        color: var(--chef-gold);
        font-weight: 700;
    }

    .minimal-input:focus {
        border-bottom-color: var(--chef-gold);
    }

    /* כפתור הגשה יוקרתי */
    .chef-submit-btn {
        width: 100%;
        padding: 16px;
        background: var(--chef-dark);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
    }

        .chef-submit-btn:hover {
            background: #000;
            transform: translateY(-2px);
        }

    .form-footer {
        margin-top: 25px;
        text-align: center;
        font-size: 0.9rem;
        color: #777;
    }

        .form-footer a {
            color: var(--chef-gold);
            text-decoration: none;
            font-weight: 700;
            margin-right: 5px;
        }

    .back-home {
        position: absolute;
        top: 30px;
        left: 30px;
        background: white;
        border: 1px solid #eee;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        cursor: pointer;
        transition: 0.3s;
    }

        .back-home:hover {
            background: #f0f0f0;
        }

    .elegant-error {
        background: #fdf2f2;
        color: #d32f2f;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 0.9rem;
        text-align: center;
    }

    /* רספונסיביות */
    @@media (max-width: 768px) {
        .brand-side {
            display: none;
        }

        .login-wrapper {
            max-width: 450px;
            height: auto;
        }
    }
</style>

@code {
    private string Email = "";
    private string Password = "";
    private string ErrorMessage = "";
    private bool IsLoading = false;

    async Task Login()
    {
        if (string.IsNullOrWhiteSpace(Email) || string.IsNullOrWhiteSpace(Password))
        {
            ErrorMessage = "אנא מלא את כל השדות";
            return;
        }

        IsLoading = true;
        ErrorMessage = "";

        try
        {
            ChefDB chefDB = new ChefDB();
            Chef chef = await chefDB.LoginAsync(Email, Password);

            if (chef != null)
            {
                await Session.SetAsync("chefid", chef.ChefID);
                Nav.NavigateTo("/ChefDashboard");
            }
            else
            {
                ErrorMessage = "פרטי הכניסה אינם נכונים";
            }
        }
        catch (Exception ex)
        {
            ErrorMessage = "שגיאת שרת. נסה שנית מאוחר יותר.";
        }
        finally
        {
            IsLoading = false;
        }
    }
}