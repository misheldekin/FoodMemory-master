@page "/EditMeal/{MealId:int}"
@using Models
@using DBL
@inject NavigationManager Nav

<div class="page" dir="rtl">

    <h2>✏️ עריכת ארוחה</h2>

    @if (meal == null)
    {
        <p class="status">טוען נתונים...</p>
    }
    else
    {
        <div class="form-box">

            <label>שם הארוחה</label>
            <input type="text" @bind="meal.name" />

            <div class="buttons">
                <button class="btn save" @onclick="Save">💾 שמור</button>
                <button class="btn cancel" @onclick="Back">❌ ביטול</button>
            </div>

        </div>
    }

</div>

<style>
    .page {
        max-width: 500px;
        margin: 80px auto;
        padding: 20px;
        font-family: Rubik, sans-serif;
    }

    h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #414833;
    }

    .form-box {
        background: #ffffff;
        padding: 30px;
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    label {
        font-weight: 600;
        display: block;
        margin-bottom: 8px;
    }

    input {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-bottom: 25px;
        font-size: 1rem;
    }

    .buttons {
        display: flex;
        gap: 15px;
    }

    .btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
    }

    .save {
        background: #737A5D;
        color: white;
    }

    .cancel {
        background: #e0e0e0;
    }

    .status {
        text-align: center;
        margin-top: 50px;
    }
</style>

@code {
    [Parameter]
    public int MealId { get; set; }

    Meals meal;

    protected override async Task OnInitializedAsync()
    {
        MealsDB db = new MealsDB();
        meal = await db.SelectByPkAsync(MealId);

        if (meal == null)
        {
            Nav.NavigateTo("/MyMeals");
        }
    }

    async Task Save()
    {
        MealsDB db = new MealsDB();
        await db.UpdateAsync(meal);
        Nav.NavigateTo("/MyMeals");
    }

    void Back()
    {
        Nav.NavigateTo("/MyMeals");
    }
}
